---
layout: page
title: Debugging Express
menu: guide
lang: en
redirect_from: "/guide/debugging.html"
---
<div id="page-doc" markdown="1">
# Debugging Express

Express uses the [debug](https://www.npmjs.com/package/debug) module
internally to log information about route matches, middleware functions that are in use, application mode,
and the flow of the request-response cycle.

<div class="doc-box doc-info" markdown="1">
`debug` is like an augmented version of `console.log`, but unlike `console.log`, you don't have to
comment out `debug` logs in production code. Logging is turned off by default and can be conditionally turned on by using the `DEBUG` environment variable.
</div>

To see all the internal logs used in Express, set the `DEBUG` environment variable to
`express:*` when launching your app.

```sh
$ DEBUG=express:* node index.js
```

On Windows, use the corresponding command.

```sh
> set DEBUG=express:* & node index.js
```

Running this command on the default app generated by the [express generator](/{{ page.lang }}/starter/generator.html) prints the following output:

```sh
$ DEBUG=express:* node ./bin/www
  express:router:route new / +0ms
  express:router:layer new / +1ms
  express:router:route get / +1ms
  express:router:layer new / +0ms
  express:router:route new / +1ms
  express:router:layer new / +0ms
  express:router:route get / +0ms
  express:router:layer new / +0ms
  express:application compile etag weak +1ms
  express:application compile query parser extended +0ms
  express:application compile trust proxy false +0ms
  express:application booting in development mode +1ms
  express:router use / query +0ms
  express:router:layer new / +0ms
  express:router use / expressInit +0ms
  express:router:layer new / +0ms
  express:router use / favicon +1ms
  express:router:layer new / +0ms
  express:router use / logger +0ms
  express:router:layer new / +0ms
  express:router use / jsonParser +0ms
  express:router:layer new / +1ms
  express:router use / urlencodedParser +0ms
  express:router:layer new / +0ms
  express:router use / cookieParser +0ms
  express:router:layer new / +0ms
  express:router use / stylus +90ms
  express:router:layer new / +0ms
  express:router use / serveStatic +0ms
  express:router:layer new / +0ms
  express:router use / router +0ms
  express:router:layer new / +1ms
  express:router use /users router +0ms
  express:router:layer new /users +0ms
  express:router use / &lt;anonymous&gt; +0ms
  express:router:layer new / +0ms
  express:router use / &lt;anonymous&gt; +0ms
  express:router:layer new / +0ms
  express:router use / &lt;anonymous&gt; +0ms
  express:router:layer new / +0ms
```

When a request is then made to the app, you will see the logs specified in the Express code:

```sh
  express:router dispatching GET / +4h
  express:router query  : / +2ms
  express:router expressInit  : / +0ms
  express:router favicon  : / +0ms
  express:router logger  : / +1ms
  express:router jsonParser  : / +0ms
  express:router urlencodedParser  : / +1ms
  express:router cookieParser  : / +0ms
  express:router stylus  : / +0ms
  express:router serveStatic  : / +2ms
  express:router router  : / +2ms
  express:router dispatching GET / +1ms
  express:view lookup "index.pug" +338ms
  express:view stat "/projects/example/views/index.pug" +0ms
  express:view render "/projects/example/views/index.pug" +1ms
```

To see the logs only from the router implementation set the value of `DEBUG` to `express:router`. Likewise, to see logs only from the application implementation set the value of `DEBUG` to `express:application`, and so on.

## Applications generated by `express`

An application generated by the `express` command also uses the `debug` module and its debug namespace is scoped to the name of the application.

For example, if you generated the app with `$ express sample-app`, you can enable the debug statements with the following command:

```sh
$ DEBUG=sample-app node ./bin/www
```

You can specify more than one debug namespace by assigning a comma-separated list of names:

```sh
$ DEBUG=http,mail,express:* node index.js
```

For more information about `debug`, see the [debug](https://www.npmjs.com/package/debug).
</div>

## Tracing

Express offers tracing capabilities. It allows you to follow and inspect the
behaviour of your controllers through the response object.
It requires that you instrument your application with tracers.Â Then you can simply call a `trace` method on your response object each time you want to record something.

### Example 1: add debug messages.

```
var express = require('express')
var debug = require('debug')('trace:response')

var app = express()

app.instrument(function (options){
  debug(options.date + ' ' + options.event)
})

app.get('/', function (req, res){
  res.trace('index:hello')
  res.send('hello world')
})
```

### Example 2: Time interval

In some cases you, may want to capture time spent on a specific request. Here
is a way to do it through tracing.

```
var express = require('express');
var debug = require('debug')('trace:response');

var app = express();
var responseTime = {};

app.instrument(function (options){
  if (options.event === 'duration:start') {
    responseTime[options.res.id] = options.date;
  } else if (options.event === 'duration:end') {
    var interval = options.date - responseTime[options.res.id];
    debug(options.req.path + ' - ' + interval + 'ms');
    delete responseTime[options.res.id];
  }
})

app.use(function(req, res, next){
  res.id = Math.floor(Math.random() * 1000000);
  res.trace('duration:start');
  next();
});

app.get('/', function (req, res){
  res.trace('index:hello');
  res.send('hello world');
  res.trace('duration:end');
})
```

### Example 3: send information to dtrace.

Dtrace is a common tool for tracing. It generates probes that will listen and
report any event targeted to it. You can simply reach the probe via the trace
function.

```
var express = require('express');
var dtrace = require('dtrace-provider');

var app = express();

var dtp = dtrace.createDTraceProvider("nodeapp");
var p1 = dtp.addProbe("probe1", "char *", "char *");
var p2 = dtp.addProbe("probe2", "char *", "char *");
dtp.enable();

app.instrument(function (options){
  dtp.fire("probe1", function(){
    return [options.event, options.date];
  });
  dtp.fire("probe2", function(){
    return [options.event, options.args[0]];
  });
});

app.get('/', function (req, res){
  res.trace('index:hello');
  res.send('hello world');
})

app.listen(3000);
```

### Example 4: Send information to chrome tracer.

You may want to use the chrome tracer to analyze only some response behaviour.

```
var express = require('./index');
var app = express();

var events = [];

app.instrument(function (options){
  if (options.event === 'start') {
    events.push({
      "name": options.args[0],
      "cat": "PERF",
      "ph": "B",
      "pid": process.pid,
      "ts": options.date.getTime()
    });
  } else if (options.event === 'end') {
    events.push({
      "name": options.args[0],
      "cat": "PERF",
      "ph": "E",
      "pid": process.pid,
      "ts": options.date.getTime()
    });
  }
})

app.get('/', function (req, res, next){
  res.trace('start', 'index');
  setTimeout(function () {
    res.send('hello world');
    res.trace('end');
  }, Math.random() * 100);
})

process.on('SIGINT', function (){
  require('fs').writeFileSync('./myfile', JSON.stringify(events));
  process.exit(0);
})

app.listen(3000);
```
