<head>
    <title>{{ page.title }}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/images/favicon.png" />
    <script>
        const themeWatcher = watchColorSchemeChange((colorScheme) => {
            if (!hasLocalStorage()) {
                document?.addEventListener('DOMContentLoaded', () => {
                // remove icon - toggle not supported
                document.querySelector('#theme-icon-container').remove()
                toggleSystemTheme(colorScheme)
                })
            } else {
                const systemTheme = localStorage.getItem('system-theme')
                const localTheme = localStorage.getItem('local-theme')
                // // if no local theme set - system is default
                if (localTheme === null) {
                    toggleSystemTheme(colorScheme)
                    localStorage.setItem('system-theme', colorScheme || 'light')
                } else {
                    // listen for system changes, update if any 
                    if (colorScheme != systemTheme) {
                        toggleSystemTheme(colorScheme)
                        localStorage.setItem('system-theme', colorScheme || 'light')
                        // override local theme 
                        localStorage.removeItem('local-theme')
                    } else {
                        // else load local theme
                        if (localTheme === 'light') {
                            lightModeOn()
                        } else if (localTheme === 'dark') {
                            darkModeOn()
                        }
                    }
                }
                document.addEventListener('DOMContentLoaded', () => {
                    const themeToggleElement = document.querySelector('.theme-toggle');

                    if (themeToggleElement) {
                        themeToggleElement.addEventListener('click', toggleStorageTheme);
                    } else {
                        console.error('Error: document object is not available');
                    }
                })
            }
        })
        function toggleSystemTheme(theme) {
            //  only support dark, else any other defaults to light 
            if (theme === 'dark') {
                darkModeOn()
            } else {
                lightModeOn()
            }
        }
        function toggleStorageTheme(e) {
            const localTheme = localStorage.getItem('local-theme')
            if (localTheme === 'light') {
                localStorage.setItem('local-theme', 'dark')
                darkModeOn()
            } else if (localTheme === 'dark') {
                localStorage.setItem('local-theme', 'light')
                lightModeOn()
                // localTheme still null
            } else {
                // need to check page state then set
                if (darkModeState()) {
                    localStorage.setItem('local-theme', 'light')
                    lightModeOn()
                } else {
                    localStorage.setItem('local-theme', 'dark')
                    darkModeOn()
                }
            }
        }
        function darkModeOn() {
            document?.documentElement?.classList?.add('dark-mode')
        }
        function lightModeOn() {
            document?.documentElement?.classList.remove('dark-mode')
        }
        function darkModeState() {
            return document.documentElement.classList.contains('dark-mode')
        }
        function hasLocalStorage() {
            return typeof Storage !== 'undefined'
        }
        function watchColorSchemeChange(callback) {
            const darkMediaQuery = window?.matchMedia('(prefers-color-scheme: dark)')

            const handleChange = (event) => {
                const newColorScheme = event?.matches ? 'dark' : 'light'
                callback(newColorScheme)
            }
            darkMediaQuery.addEventListener('change', handleChange)
            // handle init load value
            callback(darkMediaQuery.matches ? 'dark' : 'light')
            // Return a function to remove the event listener
            return () => darkMediaQuery.removeEventListener('change', handleChange)
        }

    </script>
    <link rel="stylesheet" href="/css/dark-theme.css?_={{ site.time | date: '%s' }}">
    <link rel="stylesheet" href="/css/style.css?_={{ site.time | date: '%s' }}">
    <link rel="stylesheet" href="/css/dropit.css">
    <link rel="stylesheet" href="/css/prism.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;amp;subset=latin,latin-ext">
    <link rel="stylesheet" href="/css/{{ page.lang }}.css">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="{{page.description}}">

    <meta property="og:url" content="https://expressjs.com">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{page.title}}">
    <meta property="og:description" content="{{page.description}}">
    <meta property="og:image" content="https://expressjs.com/images/og.png">                

    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="expressjs.com">
    <meta property="twitter:url" content="https://expressjs.com">
    <meta name="twitter:title" content="{{page.title}}">
    <meta name="twitter:description" content="{{page.description}}">
    <meta name="twitter:image" content="https://expressjs.com/images/og.png">

    <script data-cfasync="false" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script data-cfasync="false" src="/js/ismobile.js"></script>
    <script data-cfasync="false" src="/js/app.js"></script>
    <script data-cfasync="false" src="/js/retina.js"></script>
    <script data-cfasync="false" src="/js/dropit.js"></script>
    <script data-cfasync="false" src="/js/prism.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>